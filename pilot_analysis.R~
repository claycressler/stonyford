##
library(magrittr)
library(plyr)
library(tidyverse)
x <- read.csv("Stony_Ford_pilot.csv")
names(x)
colnames(x)[1] <- "year"
colnames(x)[7] <- "mln.ifn"
colnames(x)[8] <- "mln.il13"
colnames(x)[9] <- "gp.ifn"
colnames(x)[10] <- "gp.il13"
mutate(x,
       mln.ifn=as.numeric(as.character(mln.ifn)),
       mln.il13=as.numeric(as.character(mln.il13))) -> x
## for each infected treatment, condense
levels(x$treatment)
lapply(levels(x$treatment),
       function(t) ## build a dataframe with the key information for this treatment
           data.frame(year=subset(x, treatment==t)[1,'year'],
                      treatment=subset(x, treatment==t)[1,'treatment'],
                      push.to.IFN=subset(x, treatment==t)[1,'push.to.IFN'],
                      timepoint=subset(x, treatment==t)[1:(nrow(subset(x,treatment==t))/2),"timepoint"],
                      gp.ifn=subset(x, treatment==t)[1:(nrow(subset(x,treatment==t))/2),"gp.ifn"],
                      gp.il13=subset(x, treatment==t)[1:(nrow(subset(x,treatment==t))/2),"gp.il13"],
                      mln.ifn=subset(x, treatment==t)[(nrow(subset(x,treatment==t))/2+1):nrow(subset(x,treatment==t)),"mln.ifn"],
                      mln.il13=subset(x, treatment==t)[(nrow(subset(x,treatment==t))/2+1):nrow(subset(x,treatment==t)),"mln.il13"],
                      worm.count=subset(x, treatment==t)[1:(nrow(subset(x,treatment==t))/2),"worm.count"],
                      worm.biomass=subset(x, treatment==t)[1:(nrow(subset(x,treatment==t))/2),"worm.biomass"])
       ) %>% do.call(rbind.data.frame, .)  -> y
y$push.to.IFN <- relevel(y$push.to.IFN, "strong")

## Two ways to visualize worm burden
par(mfrow=c(1,2), mar=c(3,1.5,0.5,0.5), oma=c(2,2.5,0,0))
## box plots focus attention on mean differences
with(y, plot(push.to.IFN, worm.count, pch=21))
## points plots focus attention on variability
plot.new()
plot.window(xlim=c(0.5,3.5), ylim=range(y$worm.count,na.rm=T))
axis(2, tick=T, labels=FALSE);axis(1, at=1:3, tick=T, labels=c("strong","moderate","weak"));box('plot')
with(y, points(push.to.IFN, worm.count, pch=21, bg=1))
mtext(side=1, line=0, outer=T, "Push towards Th2 response")
mtext(side=2, line=1, outer=T, "Worm burden")
